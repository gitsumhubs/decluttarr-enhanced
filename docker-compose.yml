services:
  decluttarr:
    build:
      context: .
      dockerfile: docker/Dockerfile
    container_name: decluttarr
    restart: unless-stopped
    environment:
    - TZ=America/Detroit
    - PUID=1000
    - PGID=1000
    - LOG_LEVEL=INFO
    - REMOVE_TIMER=6
    - REMOVE_FAILED=True
    - REMOVE_FAILED_IMPORTS=True
    - REMOVE_METADATA_MISSING=True
    - REMOVE_MISSING_FILES=True
    - REMOVE_ORPHANS=True
    - REMOVE_SLOW=False
    - REMOVE_STALLED=True
    - REMOVE_UNMONITORED=False
    - MIN_DOWNLOAD_SPEED=100
    - PERMITTED_ATTEMPTS=1
    - IGNORE_PRIVATE_TRACKERS=False
    - NO_STALLED_REMOVAL_QBIT_TAG=Don't Kill
    - RADARR_URL=http://YOUR_RADARR_IP:7878
    - RADARR_KEY=YOUR_RADARR_API_KEY
    - SONARR_URL=http://YOUR_SONARR_IP:8989
    - SONARR_KEY=YOUR_SONARR_API_KEY
    # Optional: Uncomment and configure additional *arr apps
    # - LIDARR_URL=http://YOUR_LIDARR_IP:8686
    # - LIDARR_KEY=YOUR_LIDARR_API_KEY
    # - READARR_URL=http://YOUR_READARR_IP:8787
    # - READARR_KEY=YOUR_READARR_API_KEY
    # - QBITTORRENT_URL=http://YOUR_QBIT_IP:8080
    # - QBITTORRENT_USERNAME=YOUR_QBIT_USERNAME
    # - QBITTORRENT_PASSWORD=YOUR_QBIT_PASSWORD
    networks:
    - decluttarr_network
    
  manager:
    build:
      context: .
      dockerfile_inline: |
        FROM python:3.11-slim
        RUN apt-get update && apt-get install -y docker.io && rm -rf /var/lib/apt/lists/*
        RUN pip install flask pyyaml requests
        WORKDIR /app
        COPY decluttarr-manager.py .
        EXPOSE 8081
        CMD ["python", "decluttarr-manager.py"]
    container_name: decluttarr-manager
    restart: unless-stopped
    ports:
    - 8081:8081
    volumes:
    - /var/run/docker.sock:/var/run/docker.sock:ro
    - .:/docker/decluttarr
    environment:
    - TZ=America/Detroit
    networks:
    - decluttarr_network
    
  log-viewer:
    image: amir20/dozzle:latest
    container_name: decluttarr-logs
    restart: unless-stopped
    ports:
    - 9999:8080
    volumes:
    - /var/run/docker.sock:/var/run/docker.sock:ro
    environment:
    - DOZZLE_FILTER=name=decluttarr
    - DOZZLE_NO_ANALYTICS=true
    networks:
    - decluttarr_network
    
networks:
  decluttarr_network:
    driver: bridge